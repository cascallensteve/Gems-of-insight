<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Blog Loading</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        pre { white-space: pre-wrap; font-size: 12px; }
    </style>
</head>
<body>
    <h1>üêõ Debug Blog Loading Issue</h1>
    
    <button onclick="debugBlogLoading()">üîç Debug Blog Data</button>
    
    <div id="results"></div>

    <script>
        async function debugBlogLoading() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>üîç Debugging blog loading...</p>';

            try {
                // Test 1: Fetch raw API data
                console.log('Step 1: Fetching raw API data...');
                const response = await fetch('https://gems-of-truth.vercel.app/blogs/all-blogs', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Raw API data:', data);

                // Test 2: Transform data like BlogPage does
                console.log('Step 2: Transforming data...');
                
                const getRandomImage = () => {
                    const images = [
                        "https://res.cloudinary.com/djksfayfu/image/upload/v1753346939/young-woman-with-curly-hair-sitting-cafe_pbym6j.jpg",
                        "https://res.cloudinary.com/djksfayfu/image/upload/v1753347468/colorful-fruits-tasty-fresh-ripe-juicy-white-desk_jalaan.jpg",
                        "https://res.cloudinary.com/djksfayfu/image/upload/v1748982986/basket-full-vegetables_mp02db.jpg"
                    ];
                    return images[Math.floor(Math.random() * images.length)];
                };

                const getCategoryFromTags = (tags) => {
                    if (!tags || tags.length === 0) return 'health';
                    
                    const healthTags = ['health', 'nutrition', 'wellness', 'exercise', 'god', 'relationships'];
                    const hasHealthTag = tags.some(tag => 
                        healthTags.includes(tag.toLowerCase())
                    );
                    
                    return hasHealthTag ? 'health' : 'products';
                };

                const getAuthorName = (author) => {
                    if (!author) return 'Anonymous';
                    return `${author.first_name || ''} ${author.last_name || ''}`.trim() || author.email || 'Anonymous';
                };

                const blogs = data.blogs || [];
                console.log('Number of blogs:', blogs.length);

                const transformedBlogs = blogs.map(blog => {
                    console.log('Processing blog:', blog.id, blog.title);
                    
                    try {
                        return {
                            id: blog.id,
                            title: blog.title,
                            excerpt: blog.description,
                            image: getRandomImage(),
                            category: getCategoryFromTags(blog.tags),
                            date: blog.timestamp,
                            author: getAuthorName(blog.author),
                            readTime: blog.read_time,
                            tags: blog.tags || [],
                            body: blog.body
                        };
                    } catch (transformError) {
                        console.error('Error transforming blog:', blog.id, transformError);
                        return null;
                    }
                }).filter(blog => blog !== null);

                console.log('Transformed blogs:', transformedBlogs);

                resultsDiv.innerHTML = `
                    <div class="result success">
                        <h3>‚úÖ Blog Loading Debug Results</h3>
                        <p><strong>API Response Status:</strong> ${response.status}</p>
                        <p><strong>Raw Blogs Count:</strong> ${blogs.length}</p>
                        <p><strong>Transformed Blogs Count:</strong> ${transformedBlogs.length}</p>
                        
                        <h4>üìä Sample Blog Data:</h4>
                        ${blogs.length > 0 ? `
                            <p><strong>Raw Blog Sample:</strong></p>
                            <pre>${JSON.stringify(blogs[0], null, 2)}</pre>
                            
                            <p><strong>Transformed Blog Sample:</strong></p>
                            <pre>${JSON.stringify(transformedBlogs[0], null, 2)}</pre>
                        ` : '<p>No blogs found</p>'}
                        
                        <h4>üîç Analysis:</h4>
                        <ul>
                            <li>API accessible: ‚úÖ</li>
                            <li>Data transformation: ${transformedBlogs.length === blogs.length ? '‚úÖ' : '‚ùå'}</li>
                            <li>Sample blog has title: ${blogs.length > 0 && blogs[0].title ? '‚úÖ' : '‚ùå'}</li>
                            <li>Sample blog has author: ${blogs.length > 0 && blogs[0].author ? '‚úÖ' : '‚ùå'}</li>
                            <li>Sample blog has tags: ${blogs.length > 0 && blogs[0].tags ? '‚úÖ' : '‚ùå'}</li>
                        </ul>
                        
                        ${transformedBlogs.length !== blogs.length ? `
                            <div style="background: #f8d7da; padding: 10px; border-radius: 4px; margin: 10px 0;">
                                <h4>‚ö†Ô∏è Data Transformation Issue Detected</h4>
                                <p>Some blogs failed to transform. Check console for details.</p>
                            </div>
                        ` : ''}
                    </div>
                `;

            } catch (error) {
                console.error('Debug error:', error);
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Debug Failed</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>Check the console for more details.</p>
                    </div>
                `;
            }
        }

        // Run debug on page load
        debugBlogLoading();
    </script>
</body>
</html>
